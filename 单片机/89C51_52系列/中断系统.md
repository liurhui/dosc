###### 2020/7/12周日 下午

1、存储空间了解
2、运行机制
3、底层  指令集 汇编语言 内核结构 先了解   后熟悉   没必要掌握学习成本太高 从应用编写关联就好
https://www.bilibili.com/video/BV1ht4y1m794
4、掌握指针   这里的指针是 底层写好的 

##### 中断源    （请示CPU中断的请求源 称为）
当多个中断源同时向CPU请求，采用优先级 ，每个中断源有一个优先级别  。响应最高的中断请求。

TF0   TF1    

1、(P3.2）可由IT0(TCON.0)选择其为低电平有效还是下降沿有效。当CPU检测到P3.2引脚上出现有效的中断信号时，中断标志IE0(TCON.1)置1，向CPU申请中断。

2、(P3.3）可由IT1(TCON.2)选择其为低电平有效还是下降沿有效。当CPU检测到P3.3引脚上出现有效的中断信号时，中断标志IE1(TCON.3)置1,向CPU申请中断。

3、TF0（TCON.5），片内定时/计数器T0溢出中断请求标志。当定时/计数器T0发生溢出时，置位TF0，并向CPU申请中断。

4、TF1（TCON.7），片内定时/计数器T1溢出中断请求标志。当定时/计数器T1发生溢出时，置位TF1，并向CPU申请中断。

5、RI（SCON.0）或TI（SCON.1），串行口中断请求标志。当串行口接收完一帧串行数据时置位RI或当串行口发送完一帧串行数据时置位TI，向CPU申请中断。

TF0  置位 向CPU申请中断   进入 中断函数  处理完 返回 

中断函数   先把TF0 清零 

跳转怎么跳 采用指针进行跳转  进入中断函数   返回还得通过指针返回到 跳转处的地方

 

同时发生多个中断 进入中断优先级处理 机制

如果处理中断时又触发另一个中断  称为 嵌套中断    是先处理掉最高优先级   再去处理低优先级  89c51 提供8个中断请求源  

**外部中断0     定时器0中断   外部中断1   定时器1中断  串口UART中断   定时器2中断  外部中断2   外部中断3**

所有中断又 4个中断优先级    通过 总中断允许位 EA/IE.7   或  中断允许位来屏蔽所有的中断请求。 低优先级不可打断 高优先级以及 同级优先级的中断  。  高 优先级可以打断 低优先级的中断。  

同时触发的 两个同优先级的中断  由CPU来查询次序 表   查询 是 同优先级别  里 轮询进行检测 不在main里实现是独立的 。当检测到 1说明有中断函数触发了 去通过指针跳转到 中断函数  。。

##### 查询 同优先级 的顺序 

​	INT0 最高  依次 下去 INT1第二     。如果 INT1先执行 了那么 触发 INT0 得 先执行完INT1才去执行INT0



外部中断就是 外接 变成高电平触发

![](C:\Users\liurhui\Desktop\C语言学习\单片机部分\中断\中断请求源.jpg)



![](C:\Users\liurhui\Desktop\C语言学习\单片机部分\中断\中断源1.png)

 IE0 =1  外部中断0 触发     EX0 =1是 开启外部中断0的 开关     EA是中断系统的开关

INT0 设置  0   则   TCON.0/IT0  =0   通过 非门   变1   使得IE0 =1

INT0 设置  1	则  TCON.0/IT0=1   通过高低脉冲  只有从高电平 变成低电平期间 就是下降沿 期间 使得  IE0 =1

当 IE0 =1   EX0闭合    EA 闭合    进入 寄存器 设置 （PX0H,PX0） 决定是哪个优先级  进行判断 4个优先级     

------

T2 中断  是根据  （TF2 & EXF2）  =1   

#### 5、掌握  寄存器 了解 中断所有功能

IE  中断允许寄存器   （可位）   //这个 寄存器只有6个

​		EA=1    

XICON   辅助中断控制寄存器  	（可位）   //补充到这里 2个  

------



IPH  中断优先级控制寄存器 高	

IP  中断优先级控制寄存器 低  	（可位）

TCON  定时器/计数器0/1 中断控制寄存器     	（可位）

SCON 串口控制寄存器	（可位）

 T2CON  定时器/计数器2 中断控制寄存器      （可位）



#### 实现

假设 定时器 T0  

TF 标志位置1 后 不用手动清0 会自动清0处理 

​	则ET0  =1  、   (PT0H,PT0)   设置为 4个优先级里的哪个  或者采用默认（0，0）最低优先

设置中断函数 名    

```c
void InterruptTimer0() interrupt 1   //interrupt 1 表示中断号
    
    0   外部0
    1	定时器0
    2	外部1
    3	定时器1
    4	串口
    5	定时器2
    6	外部2
    7	外部3
```

